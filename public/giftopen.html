<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>プレゼントをひらく | えらべるギフト</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f4eee8;
      --ink:#262626;
      --muted:#938579;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      font-family:"Noto Sans JP","Hiragino Sans","-apple-system",system-ui,sans-serif;
      color:var(--ink);
      background:var(--bg);
      -webkit-font-smoothing:antialiased;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px 16px calc(32px + var(--safe-bottom));
    }

    .wrap{
      max-width:480px;
      width:100%;
      text-align:center;
    }

    .title{
      font-size:22px;
      letter-spacing:.16em;
      text-transform:uppercase;
      font-weight:700;
      margin-bottom:4px;
      transition: opacity 0.5s ease;
    }

    .caption{
      font-size:13px;
      color:var(--muted);
      margin-bottom:32px;
      transition: opacity 0.5s ease;
    }

    .gift-box{
      display:inline-flex;
      flex-direction:column;
      align-items:center;
      gap:20px;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      transition: transform 0.2s ease;
    }

    .gift-box:hover {
      transform: scale(1.02);
    }

    #playerHost{
      width:min(260px,70vw);
      height:min(260px,70vw);
    }
    
    dotlottie-player{
      width:100%;
      height:100%;
      display:block;
    }

  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">GIFT FOR YOU</div>
    <div class="caption">あなたへの特別なプレゼントが届きました</div>

    <div class="gift-box" id="giftBox">
      <div id="playerHost">
        <dotlottie-player
          id="giftPlayer"
          src="/assets/opengift.lottie"
          background="transparent"
          speed="1"
        ></dotlottie-player>
      </div>
    </div>
  </div>

  <!-- ▼ id / preview を URL から読み取り、保存する処理（修正版） ▼ -->
  <script>
    (function(){
      const params = new URLSearchParams(location.search);

      // id=xxx
      const id = params.get("id") || null;

      // preview=1 判定
      const urlPreview =
        params.get("preview") === "1" ||
        params.get("preview") === "true";

      const storedPreview = sessionStorage.getItem("eraberuGift_preview") === "1";
      const isPreview = urlPreview || storedPreview;

      // ▼ preview=1 のときだけ sessionStorage に保存
      if (urlPreview) {
        sessionStorage.setItem("eraberuGift_preview", "1");
      }

      // ▼ id のみ localStorage に保存（master を汚さない）
      if (id) {
        try {
          const raw  = localStorage.getItem("eraberuGift");
          const base = raw ? JSON.parse(raw) : {};
          const next = { ...base, catalogId: id };
          localStorage.setItem("eraberuGift", JSON.stringify(next));
        } catch (e) {}
      }

      // グローバルから参照可能に
      window.__ERABERU_PREVIEW__ = isPreview;
    })();
  </script>
  <!-- ▲ 修正版 ▲ -->

  <!-- アニメーション（これには触れない） -->
  <script type="module" src="/js/opengift.js"></script>
</body>
</html>
