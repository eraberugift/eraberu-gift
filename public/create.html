<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ギフトカタログを作る | えらべるギフト</title>
<link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap" rel="stylesheet">

<style>
  :root{
    --pink:#f58fb1; --ink:#2a2a2a; --muted:#6b7280;
    --bg-top:#fff1f6; --bg-bottom:#fde9d3;
    --grad:linear-gradient(90deg,#f08db0 0%,#f2b35e 100%);
    --card-bg:#fff; --shadow:0 14px 30px rgba(0,0,0,.08); --radius:18px;
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --vh: 1svh;
    --screenH: calc(var(--vh) * 100);
  }

  *{box-sizing:border-box;}
  html,body{min-height:100vh;height:auto;}
  body{
    margin:0;
    font-family:"Kosugi Maru","Hiragino Maru Gothic ProN","Hiragino Sans","Noto Sans JP",system-ui,-apple-system;
    color:var(--ink);
    background:linear-gradient(180deg,var(--bg-top),var(--bg-bottom)) fixed;
    background-size:100% 100%;
  }
  a{color:inherit;text-decoration:none;}

  .wrap{
    max-width:960px;
    margin:0 auto;
    padding:16px 16px 0;
    min-height:var(--screenH);
    display:flex;
    flex-direction:column;
  }
  .main{flex:1;display:flex;flex-direction:column;}

  .header{display:flex;align-items:center;gap:12px;padding-top:4px;}
  .brand{font-weight:800;font-size:22px;color:var(--pink);}

  .title{text-align:center;margin:20px 0 12px;}
  h1{font-size:clamp(22px,6.2vw,30px);line-height:1.25;margin:8px 0 10px;}
  .lead{
    color:var(--muted);text-align:center;
    font-size:clamp(14px,2.3vw,16px);
    line-height:1.9;max-width:620px;margin:0 auto 12px;
  }

  .form-card{
    background:var(--card-bg);border-radius:var(--radius);box-shadow:var(--shadow);
    padding:18px 18px 6px;max-width:520px;width:92%;margin:0 auto 24px;
  }

  .product-block{padding:12px 0 16px;}
  .product-block + .product-block{border-top:1px solid #f1f1f3;margin-top:4px;}
  .product-title{font-weight:700;margin-bottom:6px;font-size:14px;}

  .field{margin-bottom:12px;}
  .field-label{font-size:13px;margin-bottom:4px;display:flex;gap:4px;}
  .req{color:var(--pink);font-size:12px;}

  .field input{
    width:100%;border-radius:10px;border:1px solid #e5e7eb;
    padding:11px 12px;font-size:14px;background:#fff;
  }
  .field input:focus{
    outline:none;border-color:#f9a8c7;box-shadow:0 0 0 1px rgba(245,143,177,.35);
  }

  .footer{padding:10px 4px calc(36px + var(--safe-bottom));margin-top:4px;}
  .btn{
    width:100%;padding:16px 20px;border-radius:14px;background:var(--grad);
    color:#fff;font-size:15px;font-weight:800;box-shadow:0 12px 28px rgba(240,141,176,.25);
    cursor:pointer;border:none;
  }
</style>
</head>

<body>
<div class="wrap">
  <header class="header">
    <div class="logo" aria-hidden="true">
      <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="var(--pink)" stroke-width="2">
        <rect x="3" y="8" width="18" height="12" rx="2"/>
        <path d="M12 8v12"/><path d="M3 12h18"/>
        <path d="M7.5 6a2.5 2.5 0 1 1 5 0v2h-5V6z"/>
        <path d="M11.5 6a2.5 2.5 0 1 1 5 0v2h-5V6z"/>
      </svg>
    </div>
    <div class="brand">えらべるギフト</div>
  </header>

  <main class="main">
    <section class="title">
      <h1>ギフトカタログを作る</h1>
      <p class="lead">大切な人に3つの商品から選んでもらえる<br>特別なギフトを作りましょう</p>
    </section>

    <form
    id="giftForm"
    class="form-card"
    action="https://hook.eu2.make.com/wsqbuvjclpr41aufniwan726z1yap9lx"
    method="post"
    >

      <!-- 商品1 -->
      <div class="product-block">
        <div class="product-title">商品1</div>

        <div class="field">
          <div class="field-label">商品タイトル<span class="req">＊</span></div>
          <input type="text" name="title1" placeholder="例：ふわふわタオル" required>
        </div>

        <div class="field">
          <div class="field-label">商品URL<span class="req">＊</span></div>
          <input type="url" name="url1" placeholder="https://..." required>
        </div>
      </div>

      <!-- 商品2 -->
      <div class="product-block">
        <div class="product-title">商品2</div>
        <div class="field">
          <div class="field-label">商品タイトル</div>
          <input type="text" name="title2" placeholder="例：ふわふわタオル">
        </div>
        <div class="field">
          <div class="field-label">商品URL</div>
          <input type="url" name="url2" placeholder="https://...">
        </div>
      </div>

      <!-- 商品3 -->
      <div class="product-block">
        <div class="product-title">商品3</div>
        <div class="field">
          <div class="field-label">商品タイトル</div>
          <input type="text" name="title3" placeholder="例：ふわふわタオル">
        </div>
        <div class="field">
          <div class="field-label">商品URL</div>
          <input type="url" name="url3" placeholder="https://...">
        </div>
      </div>
    </form>

    <footer class="footer">
      <button class="btn" type="submit" form="giftForm">カタログを作成する</button>
    </footer>
  </main>
</div>

<script>
/* ===== iOS実高さ対策 ===== */
function setVH(){
  const vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}
setVH();
window.addEventListener('resize', setVH);

/* ===== localStorage 保存/読み込み ===== */

const FORM_KEY = "giftDraft_v1";

/* 保存（入力のたびに） */
function saveDraft(){
  const form = document.getElementById("giftForm");
  const data = Object.fromEntries(new FormData(form).entries());
  localStorage.setItem(FORM_KEY, JSON.stringify(data));
}

/* 読み込み（画面表示時） */
function loadDraft(){
  const saved = localStorage.getItem(FORM_KEY);
  if(!saved) return;

  const data = JSON.parse(saved);
  Object.keys(data).forEach(key=>{
    const input = document.querySelector(`[name="${key}"]`);
    if(input) input.value = data[key];
  });
}

/* 初期ロード */
loadDraft();

/* 入力のたびに保存 */
document.querySelectorAll("#giftForm input").forEach(input=>{
  input.addEventListener("input", saveDraft);
});

/* ===== URLパラメータ(id / preview)の引き継ぎ対応 ===== */
(function(){
  const src = new URLSearchParams(location.search);
  const baseParams = new URLSearchParams();

  const keepKeys = ["id", "preview"];

  keepKeys.forEach(key=>{
    const v = src.get(key);
    if(v !== null) baseParams.set(key, v);
  });

  // フォーム送信時、action を書き換えて遷移
  const form = document.getElementById("giftForm");
  form.addEventListener("submit", (e)=>{
    if([ ...baseParams ].length){
      const qs = baseParams.toString();
      form.action = "giveselect.html?" + qs;
    }else{
      form.action = "giveselect.html";
    }
  });
})();

/* ====== Make Webhook 送信処理 ====== */

const MAKE_WEBHOOK_URL = "https://hook.eu2.make.com/wsqbuvjclpr41aufniwan726z1yap9lx"; 
// ↑↑ あなたの Make Webhook URL を入れてください

document.getElementById("giftForm").addEventListener("submit", async (e) => {
  e.preventDefault(); // デフォルトの form 送信を止める

  const form = document.getElementById("giftForm");
  const data = Object.fromEntries(new FormData(form).entries());

  // カタログID（作成時に発行して保存）
  let catalogId = localStorage.getItem("catalogId");
  if (!catalogId) {
    catalogId = "gift-" + Math.random().toString(36).slice(2, 10);
    localStorage.setItem("catalogId", catalogId);
  }

  // Webhook に送るデータ
  const payload = {
    catalogId: catalogId,
    title1: data.title1 || "",
    url1: data.url1 || "",
    title2: data.title2 || "",
    url2: data.url2 || "",
    title3: data.title3 || "",
    url3: data.url3 || ""
  };

  console.log("送信データ:", payload);

  try {
    await fetch(MAKE_WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    console.log("Make 送信成功");
  } catch (err) {
    console.error("Make 送信エラー:", err);
  }

  /* ----→ 元々の遷移処理をここで継続 ---- */

  const src = new URLSearchParams(location.search);
  const params = new URLSearchParams();

  ["id", "preview"].forEach(key => {
    const v = src.get(key);
    if (v !== null) params.set(key, v);
  });

  const next = params.toString()
    ? "giveselect.html?" + params.toString()
    : "giveselect.html";

  window.location.href = next;
});

</script>

</body>
</html>
